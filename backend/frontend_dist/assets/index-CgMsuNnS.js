import{r as e,a as t}from"./react-vendor-DUpYbkpg.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var r,s,a={exports:{}},n={};var l,o=(s||(s=1,a.exports=function(){if(r)return n;r=1;var t=e(),s=Symbol.for("react.element"),a=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,o=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,r){var a,n={},d=null,c=null;for(a in void 0!==r&&(d=""+r),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)l.call(t,a)&&!i.hasOwnProperty(a)&&(n[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===n[a]&&(n[a]=t[a]);return{$$typeof:s,type:e,key:d,ref:c,props:n,_owner:o.current}}return n.Fragment=a,n.jsx=d,n.jsxs=d,n}()),a.exports),i=e(),d={};var c=function(){if(l)return d;l=1;var e=t();return d.createRoot=e.createRoot,d.hydrateRoot=e.hydrateRoot,d}();const m=i.memo(({isOpen:e,onClose:t,title:r,children:s,maxWidth:a="max-w-2xl"})=>e?o.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn",onClick:t,children:o.jsxs("div",{className:`bg-white rounded-2xl shadow-2xl p-6 ${a} w-full max-h-[85vh] overflow-y-auto transform transition-all animate-slideUp`,onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-start mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900 leading-tight",children:r}),o.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 hover:bg-gray-100 rounded-lg","aria-label":"Close",children:o.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s]})}):null);function g(){const[e,t]=i.useState([]),[r,s]=i.useState(null),[a,n]=i.useState(null),[l,d]=i.useState(""),[c,g]=i.useState(!1),[x,h]=i.useState(null),[p,u]=i.useState("pls"),[b,f]=i.useState(!1),y=i.useRef([]),j=i.useRef(null),[v,N]=i.useState(!0),[w,C]=i.useState(!0),[k,S]=i.useState(!0),[_,T]=i.useState(!0),[$,E]=i.useState(!1),[P,O]=i.useState(!0),[D,F]=i.useState(!1),[I,M]=i.useState(!1),[A,B]=i.useState(!1),[R,L]=i.useState(!1),[z,W]=i.useState(!1),[G,H]=i.useState(!1),[U,J]=i.useState([]),[Y,V]=i.useState([]),[q,K]=i.useState(""),[Q,X]=i.useState(""),[Z,ee]=i.useState(!1),[te,re]=i.useState(""),[se,ae]=i.useState(!1),[ne,le]=i.useState({}),[oe,ie]=i.useState(!1),[de,ce]=i.useState([]),[me,ge]=i.useState(!1),xe=i.useRef(0),[he,pe]=i.useState(!1),[ue,be]=i.useState({current:0,total:0,status:""}),[fe,ye]=i.useState(!1),[je,ve]=i.useState(!1),[Ne,we]=i.useState(!1),[Ce,ke]=i.useState({original:null,corrected:null,difference:null}),[Se,_e]=i.useState(!1),[Te,$e]=i.useState(!1),[Ee,Pe]=i.useState(!1),[Oe,De]=i.useState(!1),[Fe,Ie]=i.useState(!1),[Me,Ae]=i.useState(!1),[Be,Re]=i.useState(null),[Le,ze]=i.useState(!0),[We,Ge]=i.useState(!1),[He,Ue]=i.useState(["CC"]),[Je,Ye]=i.useState([]),[Ve,qe]=i.useState([]),[Ke,Qe]=i.useState({manual_crop:!1,bins:50,smooth_window:5,degree:3,fit_method:"pls",interactions:!0,max_iter:1e3,tol:1e-8,verbose:!1,random_seed:0}),[Xe,Ze]=i.useState({max_degree:5}),[et,tt]=i.useState({cc_method:"ours",method:"Finlayson 2015",mtd:"pls",degree:2,max_iterations:1e4,random_state:0,tol:1e-8,verbose:!1,n_samples:50,ncomp:1,nlayers:100,hidden_layers:[64,32,16],learning_rate:.001,batch_size:16,patience:10,dropout_rate:.2,optim_type:"adam",use_batch_norm:!0}),rt=i.useRef(),st=i.useRef(),at=i.useRef(),nt=i.useRef(),lt=i.useCallback(e=>{y.current.push(e),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{if(y.current.length>0){const e=y.current.join("");y.current=[],d(t=>t+e)}},50)},[]),ot=i.useCallback(()=>{if(j.current&&clearTimeout(j.current),y.current.length>0){const e=y.current.join("");y.current=[],d(t=>t+e)}},[]);i.useEffect(()=>{nt.current&&(nt.current.scrollTop=nt.current.scrollHeight)},[l]);const it=i.useCallback(async e=>{if(0===e.length)return;const r=e.map(e=>({file:e,url:URL.createObjectURL(e)}));t(e=>[...e,...r]),lt(`\nüì§ Uploading ${e.length} image(s) to backend...`);try{const t=new FormData;e.forEach(e=>t.append("images",e));const s=await fetch("/api/upload-images",{method:"POST",body:t});if(!s.ok)throw new Error(`HTTP ${s.status}: ${await s.text()}`);const a=await s.json();lt(`\n‚úì ${a.message}`),e.length>0&&!x&&(h(r[0].url),re("Original Image"))}catch(s){lt(`\n‚úó Upload failed: ${s.message}`)}},[x,lt]),dt=i.useCallback(async e=>{const t=Array.from(e.target.files||[]);await it(t)},[it]),ct=i.useCallback(e=>{e.preventDefault(),e.stopPropagation(),xe.current++,e.dataTransfer.items&&e.dataTransfer.items.length>0&&ge(!0)},[]),mt=i.useCallback(e=>{e.preventDefault(),e.stopPropagation(),xe.current--,0===xe.current&&ge(!1)},[]),gt=i.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),xt=i.useCallback(async e=>{e.preventDefault(),e.stopPropagation(),ge(!1),xe.current=0;const t=[];if(e.dataTransfer.files&&e.dataTransfer.files.length>0){const r=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/"));if(0===r.length)return void lt("\n‚ö† No image files found in dropped items");t.push(...r)}t.length>0&&await it(t)},[it,lt]),ht=i.useCallback(async e=>{const t=e.target.files&&e.target.files[0];if(t){s({file:t,url:URL.createObjectURL(t)}),lt(`\nüì§ Uploading white image: ${t.name}...`);try{const e=new FormData;e.append("white_image",t);const r=await fetch("/api/upload-white-image",{method:"POST",body:e});if(!r.ok)throw new Error(`HTTP ${r.status}: ${await r.text()}`);const s=await r.json();lt(`\n‚úì ${s.message}`)}catch(r){lt(`\n‚úó White image upload failed: ${r.message}`)}}},[lt]),pt=i.useCallback(async e=>{const t=e.target.files&&e.target.files[0];if(n(t||null),!t)return;if(t.name.toLowerCase().endsWith(".pkl")){lt(`\nüì§ Uploading model file: ${t.name}...`);try{const e=new FormData;e.append("model_file",t);const r=await fetch("/api/upload-model",{method:"POST",body:e});if(!r.ok)throw new Error(`HTTP ${r.status}: ${await r.text()}`);const s=await r.json();lt(`\n‚úì ${s.message}`),s.model_loaded&&lt('\n‚úÖ Model loaded and ready for "Apply to Others"')}catch(r){lt(`\n‚úó Model upload failed: ${r.message}`)}}else lt(`\n‚úì Loaded CCM file: ${t.name}`)},[lt]),ut=i.useCallback(()=>{t([]),s(null),n(null),h(null),f(!1),re(""),J([]),le({}),ae(!1),g(!1),rt.current&&(rt.current.value=""),at.current&&(at.current.value=""),st.current&&(st.current.value=""),fetch("/api/clear-session",{method:"POST"}).catch(e=>{}),lt("\n‚úì Cleared all images and reset application"),ot()},[lt,ot]);async function bt(){if(0!==He.length)if(0!==Je.length){Ge(!1),d(e=>e+"\nüíæ Saving selected images and steps...");try{const e=await fetch("/api/save-images",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selected_steps:He,selected_images:Je,directory:q||void 0})}),t=await e.json();d(e=>e+`\n‚úì ${t.message}`)}catch(e){d(t=>t+`\n‚úó Save failed: ${e.message}`)}}else d(e=>e+"\n‚ö†Ô∏è Please select at least one image.");else d(e=>e+"\n‚ö†Ô∏è Please select at least one processing step.")}return o.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-950 via-indigo-950 to-gray-950 p-2 sm:p-4 md:p-6 lg:p-8 relative",onDragEnter:ct,onDragLeave:mt,onDragOver:gt,onDrop:xt,children:[me&&o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-indigo-900/90 backdrop-blur-sm pointer-events-none",children:o.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl p-12 text-center transform scale-110 animate-pulse border-4 border-dashed border-indigo-400",children:[o.jsx("div",{className:"text-8xl mb-4",children:"üìÅ"}),o.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Drop Images Here"}),o.jsx("p",{className:"text-gray-600 text-lg",children:"Release to upload your images"})]})}),o.jsx("div",{className:"max-w-[1600px] mx-auto mb-4 md:mb-6",children:o.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-4 md:p-6 shadow-2xl",children:[o.jsxs("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-white mb-2 flex items-center gap-3",children:[o.jsx("span",{className:"text-3xl sm:text-4xl md:text-5xl",children:"üé®"}),o.jsx("span",{className:"truncate bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:"Color Correction Studio"})]}),o.jsx("p",{className:"text-gray-300 text-sm md:text-base ml-12 md:ml-14",children:"A custom image color correction powered by ML algorithms"})]})}),o.jsx("div",{className:"max-w-[1600px] mx-auto bg-gradient-to-br from-white/95 to-gray-50/95 backdrop-blur-xl rounded-2xl shadow-2xl p-3 sm:p-4 md:p-6 lg:p-8 border border-white/50",children:o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-3 md:gap-6 lg:gap-8",children:[o.jsxs("div",{className:"lg:col-span-3 space-y-3 md:space-y-4 lg:space-y-6",children:[o.jsxs("div",{className:"bg-gradient-to-br from-blue-50 via-indigo-50 to-blue-50 rounded-xl p-3 sm:p-4 border-2 border-blue-200 shadow-lg hover:shadow-xl transition-shadow",children:[o.jsxs("h2",{className:"text-sm sm:text-base font-bold text-gray-800 mb-3 flex items-center gap-2",children:[o.jsx("span",{className:"text-xl",children:"üìÅ"}),o.jsx("span",{className:"truncate bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"File Management"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("label",{className:"block",children:[o.jsx("input",{ref:rt,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:dt}),o.jsx("button",{onClick:()=>rt.current.click(),className:"w-full px-3 sm:px-4 py-2.5 rounded-lg bg-gradient-to-r from-blue-500 to-indigo-600 text-white text-sm font-semibold hover:from-blue-600 hover:to-indigo-700 transition-all duration-200 shadow-md hover:shadow-lg active:scale-98 truncate",children:"üì∏ Load Images"})]}),o.jsxs("label",{className:"block",children:[o.jsx("input",{ref:at,type:"file",accept:"image/*",className:"hidden",onChange:ht}),o.jsx("button",{onClick:()=>at.current.click(),className:"w-full px-3 sm:px-4 py-2.5 rounded-lg bg-gradient-to-r from-cyan-500 to-blue-600 text-white text-sm font-semibold hover:from-cyan-600 hover:to-blue-700 transition-all duration-200 shadow-md hover:shadow-lg active:scale-98 truncate",children:"üü¶ White Image"})]}),o.jsxs("label",{className:"block",children:[o.jsx("input",{ref:st,type:"file",accept:".pkl,.csv,.txt,.json,*",className:"hidden",onChange:pt}),o.jsx("button",{onClick:()=>st.current.click(),className:"w-full px-3 sm:px-4 py-2.5 rounded-lg bg-gradient-to-r from-purple-500 to-pink-600 text-white text-sm font-semibold hover:from-purple-600 hover:to-pink-700 transition-all duration-200 shadow-md hover:shadow-lg active:scale-98 truncate",children:"üìä Model/CCM File"})]}),o.jsx("button",{onClick:async function(){if(0===e.length)return void d(e=>e+"\n‚ö† No images loaded.");if(!x||!e.some(e=>e.url===x))return void d(e=>e+"\n‚ö† Please select an image first.");const t=e.findIndex(e=>e.url===x);if(-1!==t){d(e=>e+`\nüîç Detecting color chart on image ${t+1}...`);try{const e=await fetch("/api/detect-chart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_index:t})});if(!e.ok)throw new Error(`HTTP ${e.status}: ${await e.text()}`);const r=await e.json();r.success&&r.detection.detected?(f(!0),d(e=>e+`\n‚úì ${r.detection.message} (${(100*r.detection.confidence).toFixed(0)}% confidence)`),r.detection.visualization&&(h(r.detection.visualization),re("Chart Detected")),r.detection.patch_data&&r.detection.patch_data.length>0&&d(e=>e+`\n  üìä Identified patches: ${r.detection.patch_data.slice(0,6).map(e=>e.name).join(", ")}...`)):(f(!1),d(e=>e+`\n‚ö† ${r.detection.message}`))}catch(r){f(!1),d(e=>e+`\n‚úó Chart detection failed: ${r.message}`)}}else d(e=>e+"\n‚ö† Selected image not found.")},disabled:0===e.length,className:"w-full px-3 sm:px-4 py-2.5 rounded-lg bg-gradient-to-r from-amber-500 to-orange-600 text-white text-sm font-semibold hover:from-amber-600 hover:to-orange-700 transition-all duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-md disabled:active:scale-100 active:scale-98 truncate",children:"üîç Detect Chart"}),e.length>0&&o.jsxs("button",{onClick:ut,className:"w-full px-3 sm:px-4 py-2.5 rounded-lg bg-white text-gray-700 text-sm font-semibold hover:bg-gray-50 transition-all duration-200 border-2 border-gray-300 hover:border-red-400 hover:text-red-600 shadow-sm hover:shadow-md active:scale-98 truncate",children:["üóëÔ∏è Clear All (",e.length,")"]})]})]}),o.jsxs("div",{className:"bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 rounded-xl border-2 border-green-200 shadow-lg hover:shadow-xl transition-shadow overflow-hidden",children:[o.jsxs("button",{onClick:()=>_e(!Se),className:"w-full px-4 py-3 flex items-center justify-between text-left hover:bg-green-100/50 transition-colors",children:[o.jsxs("span",{className:"text-sm font-bold text-gray-800 flex items-center gap-2",children:[o.jsx("span",{className:"text-xl",children:"‚öôÔ∏è"}),o.jsx("span",{className:"bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent",children:"Corrections"})]}),o.jsx("span",{className:"text-gray-500 text-lg font-bold",children:Se?"‚ñº":"‚ñ∂"})]}),Se&&o.jsxs("div",{className:"px-3 pb-3 space-y-1.5",children:[[{label:"FFC",state:v,setState:N,openModal:()=>F(!0)},{label:"GC",state:w,setState:C,openModal:()=>M(!0)},{label:"WB",state:k,setState:S,openModal:()=>B(!0)},{label:"CC",state:_,setState:T,openModal:()=>L(!0)}].map(({label:e,state:t,setState:r,openModal:s})=>o.jsxs("div",{className:"flex items-center gap-2 bg-white p-2 rounded-lg border border-gray-200 shadow-sm",children:[o.jsxs("label",{className:"flex items-center gap-2 flex-1 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:t,onChange:e=>r(e.target.checked),className:"w-4 h-4 rounded accent-indigo-600 cursor-pointer"}),o.jsx("span",{className:"font-bold text-gray-700 text-xs",children:e})]}),o.jsx("button",{onClick:s,className:"px-2 py-1 rounded-md text-xs font-medium bg-indigo-100 text-indigo-700 hover:bg-indigo-200 transition-colors border border-indigo-300",children:"Settings"})]},e)),o.jsxs("div",{className:"mt-3 pt-3 border-t border-green-200 space-y-2",children:[o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-white p-2 rounded-lg border border-gray-200 shadow-sm hover:bg-green-50 transition",children:[o.jsx("input",{type:"checkbox",checked:Le,onChange:e=>ze(e.target.checked),className:"w-4 h-4 rounded accent-indigo-600 cursor-pointer"}),o.jsxs("span",{className:"text-xs text-gray-700",children:[o.jsx("strong",{children:"Show result dialogs"})," after correction"]})]}),o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-white p-2 rounded-lg border border-gray-200 shadow-sm hover:bg-blue-50 transition",children:[o.jsx("input",{type:"checkbox",checked:P,onChange:e=>O(e.target.checked),className:"w-4 h-4 rounded accent-blue-600 cursor-pointer"}),o.jsxs("span",{className:"text-xs text-gray-700",children:[o.jsx("strong",{children:"Compute ŒîE metrics"})," (single image only)"]})]}),o.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"üí° Disable for faster processing without quality metrics"})]})]})]}),o.jsx("div",{className:"bg-gradient-to-br from-green-400/20 via-emerald-400/20 to-teal-400/20 rounded-xl p-3 sm:p-4 border-2 border-green-400 shadow-lg hover:shadow-xl transition-shadow",children:o.jsx("button",{onClick:async function(){if(0===e.length)return void d(e=>e+"\n‚ö† No images loaded.");if(!x||!e.some(e=>e.url===x)){if(!(window.confirm("No image selected. Would you like to select the first image and proceed?")&&e.length>0))return void d(e=>e+"\n‚ö† Please select an image first.");h(e[0].url),d(e=>e+"\n‚úì Selected first image automatically.")}const t=e.findIndex(t=>t.url===x||t.url===e[0].url);if(-1!==t){_e(!1),re(""),le({}),ae(!1),ve(!1),we(!1),Ae(!1),ke({original:null,corrected:null,difference:null}),Re(null),d(e=>e+"\nüóëÔ∏è Cleared previous results"),g(!0),d(e=>e+`\n‚ñ∂ Running Color Correction on image ${t+1}...\n`);try{const e="ours"===et.cc_method?et.mtd:"conventional",r={method:e,image_index:t,ffcEnabled:v,gcEnabled:w,wbEnabled:k,ccEnabled:_,saveCcModel:$,computeDeltaE:P,ffcSettings:Ke,gcSettings:Xe,ccSettings:et},s=await fetch("/api/run-cc",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok){const e=await s.text();throw new Error(`HTTP ${s.status}: ${e}`)}const a=await s.json();if(a.success){if(d(e=>e+"\n"+(a.log||"‚úì Completed successfully!")),a.original_image&&(h(a.original_image),re("Original Image")),a.delta_e_summary&&Object.keys(a.delta_e_summary).length>0){["FFC","GC","WB","CC"].forEach(t=>{if(a.delta_e_summary[t]&&void 0!==a.delta_e_summary[t].DE_mean){const r=a.delta_e_summary[t].DE_mean,s="number"==typeof r?r.toFixed(2):r;d("CC"===t?r=>r+`\n  üìä ${t} (${e}) - DE_mean: ${s}`:e=>e+`\n  üìä ${t} - DE_mean: ${s}`)}});const t={...a.delta_e_summary,_method:e};le(t),Le&&0===ue.total&&setTimeout(()=>{ae(!0)},100)}else d(e=>e+"\n  ‚ÑπÔ∏è No ŒîE metrics available (may not be enabled for all steps)");if(a.images&&a.images.length>0){d(e=>e+`\n‚úì Generated ${a.images.length} result image(s)`);const e=a.images.find(e=>e.name.endsWith("_CC"))||a.images[a.images.length-1];ke({original:a.original_image,corrected:e.data,difference:a.diff_image}),a.scatter_plot&&(Re(a.scatter_plot),d(e=>e+"\nüìà RGB scatter plot generated"),Le&&0===ue.total&&setTimeout(()=>{Ae(!0)},500)),a.diff_image&&_&&Le&&0===ue.total&&(d(e=>e+'\nüìä Difference image available - click "View Difference" button'),ve(!0)),a.original_image&&e.data&&Le&&0===ue.total&&(d(e=>e+'\nüîç Before/After comparison available - click "Compare Images" button'),setTimeout(()=>{we(!0)},a.diff_image&&_?3e3:100)),h(e.data),re("Corrected Image")}}else d(e=>e+`\n‚úó Pipeline error: ${a.error}`)}catch(r){d(e=>e+`\n‚úó Error: ${r.message}`)}finally{g(!1)}}else d(e=>e+"\n‚ö† Selected image not found.")},disabled:c||0===e.length,className:"w-full px-4 sm:px-5 py-3 sm:py-4 rounded-xl font-bold text-sm sm:text-base transition-all duration-200 touch-manipulation "+(c||0===e.length?"bg-gray-300 text-gray-500 cursor-not-allowed shadow-inner":"bg-gradient-to-r from-green-500 via-emerald-600 to-teal-600 text-white hover:from-green-600 hover:via-emerald-700 hover:to-teal-700 shadow-lg hover:shadow-2xl active:scale-95 animate-pulse-slow"),children:c?o.jsxs("span",{className:"flex items-center justify-center gap-2",children:[o.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"‚ñ∂Ô∏è Run Correction"})}),o.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-red-50 rounded-lg border border-orange-200 shadow-sm p-2 sm:p-0",children:[o.jsxs("button",{onClick:()=>$e(!Te),className:"w-full px-2 sm:px-3 py-2 flex items-center justify-between text-left hover:bg-orange-100/50 rounded-lg transition-colors touch-manipulation",children:[o.jsx("span",{className:"text-xs font-bold text-gray-700 uppercase tracking-wide truncate",children:"‚ö° Batch Ops"}),o.jsx("span",{className:"text-gray-500 text-sm flex-shrink-0 ml-2",children:Te?"‚ñº":"‚ñ∂"})]}),Te&&o.jsxs("div",{className:"px-2 sm:px-3 pb-2 sm:pb-3 space-y-1.5",children:[o.jsx("button",{onClick:async function(){if(0===e.length)return void d(e=>e+"\n‚ö†Ô∏è No images loaded.");try{const e=await fetch("/api/check-model"),t=await e.json();if(!t.model_available)return d(e=>e+"\n‚ö†Ô∏è No trained model available. Please:"),d(e=>e+"\n   1. Run color correction on at least one image, OR"),void d(e=>e+"\n   2. Load a saved model file (.pkl) using 'Model/CCM File' button");t.model_source&&d(e=>e+`\n‚úì Using ${t.model_source} for application`)}catch(r){return void d(e=>e+"\n‚ö†Ô∏è Could not check model status. Please run color correction or load a model file first.")}let t;if(x){const r=e.findIndex(e=>e.url===x);t=r>=0?e.map((e,t)=>t).filter(e=>e!==r):e.map((e,t)=>t)}else t=e.map((e,t)=>t);ce(t),ie(!0)},disabled:c||0===e.length,className:"w-full px-2 sm:px-3 py-1.5 rounded text-xs font-medium transition-all touch-manipulation truncate "+(c||0===e.length?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-gradient-to-r from-cyan-500 to-teal-600 text-white hover:from-cyan-600 hover:to-teal-700"),children:"üé® Apply to Others"}),o.jsx("button",{onClick:()=>pe(!0),disabled:c||0===e.length,className:"w-full px-3 py-1.5 rounded text-xs font-medium transition-all "+(c||0===e.length?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-gradient-to-r from-orange-500 to-red-600 text-white hover:from-orange-600 hover:to-red-700"),children:"‚ö° Process All"})]})]}),o.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-yellow-50 rounded-lg border border-amber-200 shadow-sm",children:[o.jsxs("button",{onClick:()=>Pe(!Ee),className:"w-full px-3 py-2 flex items-center justify-between text-left hover:bg-amber-100/50 rounded-lg transition-colors",children:[o.jsx("span",{className:"text-xs font-bold text-gray-700 uppercase tracking-wide",children:"üìä Analysis"}),o.jsx("span",{className:"text-gray-500 text-sm",children:Ee?"‚ñº":"‚ñ∂"})]}),Ee&&o.jsxs("div",{className:"px-3 pb-3 space-y-1.5",children:[o.jsx("button",{onClick:()=>ve(!0),disabled:!Ce.difference,className:"w-full px-3 py-1.5 rounded text-xs font-medium transition-all "+(Ce.difference?"bg-white border border-yellow-400 text-yellow-700 hover:bg-yellow-50":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:"üî¨ Difference"}),o.jsx("button",{onClick:()=>we(!0),disabled:!Ce.original||!Ce.corrected,className:"w-full px-3 py-1.5 rounded text-xs font-medium transition-all "+(Ce.original&&Ce.corrected?"bg-white border border-green-400 text-green-700 hover:bg-green-50":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:"üì∑ Before/After"}),o.jsx("button",{onClick:()=>Ae(!0),disabled:!Be,className:"w-full px-3 py-1.5 rounded text-xs font-medium transition-all "+(Be?"bg-white border border-purple-400 text-purple-700 hover:bg-purple-50":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:"ÔøΩ RGB Scatter"}),o.jsx("button",{onClick:()=>ae(!0),disabled:0===Object.keys(ne).length,className:"w-full px-3 py-1.5 rounded text-xs font-medium transition-all "+(0===Object.keys(ne).length?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-white border border-blue-400 text-blue-700 hover:bg-blue-50"),children:"üìä ŒîE Metrics"})]})]}),o.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-purple-50 rounded-lg border border-indigo-200 shadow-sm",children:[o.jsxs("button",{onClick:()=>De(!Oe),className:"w-full px-3 py-2 flex items-center justify-between text-left hover:bg-indigo-100/50 rounded-lg transition-colors",children:[o.jsx("span",{className:"text-xs font-bold text-gray-700 uppercase tracking-wide",children:"üíæ Data"}),o.jsx("span",{className:"text-gray-500 text-sm",children:Oe?"‚ñº":"‚ñ∂"})]}),Oe&&o.jsxs("div",{className:"px-3 pb-3 space-y-1.5",children:[o.jsx("button",{onClick:async function(){try{if(fe)await async function(){try{const e=await fetch("/api/batch-images-list"),t=await e.json();t.success&&(qe(t.images||[]),Ye(t.images.map(e=>e.image_index)))}catch(e){}}();else{const e=await fetch("/api/available-images"),t=await e.json();t.success&&t.images&&(J(t.images),Ye(t.images.map(e=>e.filename)))}Ge(!0)}catch(e){d(t=>t+`\n‚úó Failed to fetch available images: ${e.message}`)}},className:"w-full px-3 py-1.5 rounded bg-gradient-to-r from-indigo-500 to-blue-600 text-white text-xs font-medium hover:from-indigo-600 hover:to-blue-700 transition-all",children:"üíæ Save"}),o.jsx("button",{onClick:()=>W(!0),className:"w-full px-3 py-1.5 rounded bg-gradient-to-r from-violet-500 to-purple-600 text-white text-xs font-medium hover:from-violet-600 hover:to-purple-700 transition-all",children:"üì¶ Models"})]})]}),o.jsxs("div",{className:"bg-gradient-to-br from-rose-50 to-red-50 rounded-lg border border-rose-200 shadow-sm",children:[o.jsxs("button",{onClick:()=>Ie(!Fe),className:"w-full px-3 py-2 flex items-center justify-between text-left hover:bg-rose-100/50 rounded-lg transition-colors",children:[o.jsx("span",{className:"text-xs font-bold text-gray-700 uppercase tracking-wide",children:"üîß System"}),o.jsx("span",{className:"text-gray-500 text-sm",children:Fe?"‚ñº":"‚ñ∂"})]}),Fe&&o.jsxs("div",{className:"px-3 pb-3 space-y-1.5",children:[o.jsx("button",{onClick:async function(){if(!confirm("üîÑ RESTART BACKEND\n\nThis will:\n‚úì Automatically stop the current backend server\n‚úì Start a new backend server process\n‚úì Reconnect once online\n\nThe restart will happen automatically - no manual action needed!\n\nContinue?"))return;d(e=>e+"\n"+"=".repeat(60)),d(e=>e+"\nüîÑ AUTOMATIC BACKEND RESTART"),d(e=>e+"\n"+"=".repeat(60)),g(!0),d(e=>e+"\n\nüìç Phase 1: Sending restart command to backend");try{const e=new AbortController,t=setTimeout(()=>e.abort(),5e3),r=await fetch("/api/restart",{method:"POST",signal:e.signal});if(clearTimeout(t),r.ok){const e=await r.json();d(t=>t+"\n  ‚úÖ Restart initiated (PID: "+(e.pid||"unknown")+")"),d(e=>e+"\n  üîÑ Backend will restart automatically...")}}catch(r){"AbortError"===r.name||r.message.includes("Failed to fetch")?d(e=>e+"\n  ‚úÖ Restart command sent (connection closed as expected)"):d(e=>e+"\n  ‚ö†Ô∏è  "+r.message)}await new Promise(e=>setTimeout(e,2e3)),d(e=>e+"\n\nüìç Phase 2: Verifying old server shutdown");try{await fetch("/api/health",{signal:AbortSignal.timeout(1500)}),d(e=>e+"\n  ‚ö†Ô∏è  Old server still responding")}catch{d(e=>e+"\n  ‚úÖ Old server confirmed offline")}d(e=>e+"\n\nüìç Phase 3: Waiting for new backend server"),d(e=>e+"\n  ÔøΩ Backend is restarting automatically..."),d(e=>e+"\n  ‚è≥ Polling for backend (60 seconds)...");let e=0;const t=setInterval(async()=>{e++;try{(await fetch("/api/health",{signal:AbortSignal.timeout(1e3)})).ok&&(clearInterval(t),d(e=>e+"\n\n‚úÖ BACKEND IS BACK ONLINE!"),d(e=>e+"\nüéâ Automatic restart completed successfully!"),d(e=>e+"\n"+"=".repeat(60)),g(!1))}catch{e>=60?(clearInterval(t),d(e=>e+"\n\n‚è±Ô∏è  Timeout reached - backend not detected"),d(e=>e+"\nüí° Manual restart may be needed:"),d(e=>e+"\n   cd backend && python server_enhanced.py"),d(e=>e+"\n"+"=".repeat(60)),g(!1)):e%5==0&&d(t=>t+`\n  ‚è≥ Still waiting... (${e}s)`)}},1e3)},disabled:c,className:"w-full px-3 py-1.5 rounded text-xs font-medium transition-all "+(c?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-white border border-rose-400 text-rose-600 hover:bg-rose-50"),children:"üîÑ Restart"}),o.jsx("button",{onClick:async function(){if(!confirm("‚ö†Ô∏è  APPLICATION SHUTDOWN\n\nThis will automatically:\n\nüî¥ BACKEND:\n  ‚úì Stop Python Flask server (Port 5000)\n  ‚úì Cleanup temporary files\n  ‚úì Terminate all child processes\n\nüî¥ FRONTEND:\n  ‚úì Close this browser tab\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n‚ö° Both backend and frontend will shut down automatically.\n\nContinue?"))return;d(e=>e+"\n"+"=".repeat(70)),d(e=>e+"\nüõë AUTOMATIC SHUTDOWN INITIATED"),d(e=>e+"\n"+"=".repeat(70)),g(!0),d(e=>e+"\n\nüìç PHASE 1: Backend Server Shutdown"),d(e=>e+"\n   Sending shutdown signal (equivalent to Ctrl+C)...");let e=!1;try{const t=new AbortController,r=setTimeout(()=>t.abort(),5e3),s=await fetch("/api/shutdown",{method:"POST",headers:{"Content-Type":"application/json"},signal:t.signal});if(clearTimeout(r),s.ok){await s.json();d(e=>e+"\n   ‚úÖ Backend shutdown signal sent"),d(e=>e+"\n   ‚è≥ Backend terminating gracefully..."),e=!0}}catch(r){"AbortError"===r.name||r.message.includes("Failed to fetch")?(d(e=>e+"\n   ‚úÖ Backend shutdown initiated (connection closed)"),e=!0):d(e=>e+"\n   ‚ö†Ô∏è  Error: "+r.message)}d(e=>e+"\n   ‚è≥ Waiting for backend cleanup..."),await new Promise(e=>setTimeout(e,1500)),d(e=>e+"\n\nüìç PHASE 2: Verification");try{const e=new AbortController;setTimeout(()=>e.abort(),1e3),await fetch("/api/health",{signal:e.signal}),d(e=>e+"\n   ‚ö†Ô∏è  Backend still responding (may need manual Ctrl+C)")}catch{d(e=>e+"\n   ‚úÖ Backend successfully terminated"),d(e=>e+"\n   ‚úÖ Port 5000 is now free")}d(e=>e+"\n\nüìç PHASE 3: Frontend Cleanup");try{d(e=>e+"\n   üóëÔ∏è  Clearing session data..."),t([]),h(null),s(null),le({}),Re(null),ke({original:null,corrected:null,difference:null}),d(e=>e+"\n   ‚úÖ Session data cleared")}catch(r){d(e=>e+"\n   ‚ö†Ô∏è  Cleanup warning: "+r.message)}d(e=>e+"\n\n"+"=".repeat(70)),d(e=>e+"\n‚úÖ SHUTDOWN COMPLETE"),d(e=>e+"\n"+"=".repeat(70)),d(e=>e+"\n\n‚úÖ Backend: Stopped"),d(e=>e+"\n‚úÖ Cleanup: Complete"),d(e=>e+"\n‚úÖ Terminal: Ready for new commands"),d(e=>e+"\n\nüîÑ Closing browser tab in 2 seconds..."),d(e=>e+"\nüëã Thank you for using Color Correction Studio!"),setTimeout(()=>{g(!1);const e=document.createElement("div");e.innerHTML='\n        <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 10000; animation: fadeIn 0.3s ease-in;">\n          <div style="background: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 20px 40px rgba(0,0,0,0.3); max-width: 500px; width: 90%; text-align: center; animation: slideUp 0.3s ease-out;">\n            <div style="font-size: 4rem; margin-bottom: 1rem;">‚úÖ</div>\n            <h2 style="color: #1f2937; margin-bottom: 1rem; font-size: 1.5rem; font-weight: 700;">Backend Shutdown Complete</h2>\n            \n            <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: 2px solid #86efac; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">\n              <p style="color: #166534; font-weight: 600; margin-bottom: 0.5rem;">‚úì Backend Server Stopped</p>\n              <p style="color: #15803d; font-size: 0.875rem; margin: 0.5rem 0;">üóëÔ∏è Temporary files cleaned</p>\n              <p style="color: #15803d; font-size: 0.875rem; margin: 0.5rem 0;">ÔøΩ Terminal ready for commands</p>\n            </div>\n            \n            <div style="background: #f9fafb; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; border: 1px solid #e5e7eb; text-align: left;">\n              <p style="color: #374151; font-size: 0.875rem; margin-bottom: 0.75rem; font-weight: 600;">Next Steps:</p>\n              <ul style="color: #6b7280; font-size: 0.875rem; margin: 0; padding-left: 1.25rem; list-style-type: none;">\n                <li style="margin-bottom: 0.5rem;">‚úì Terminal is in initial state (ready for commands)</li>\n                <li style="margin-bottom: 0.5rem;">‚úì Frontend dev server still running (reusable)</li>\n                <li style="margin-bottom: 0.5rem;">‚úì Close this tab when done</li>\n              </ul>\n            </div>\n            \n            <div style="display: flex; gap: 0.5rem; justify-content: center;">\n              <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: #6366f1; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 600; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s;">\n                Continue Working\n              </button>\n              <button onclick="window.close()" style="background: #ef4444; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 600; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s;">\n                Close Tab\n              </button>\n            </div>\n            \n            <p style="color: #9ca3af; font-size: 0.75rem; margin-top: 1rem;">\n              üëã Thank you for using Color Correction Studio\n            </p>\n          </div>\n        </div>\n        \n        <style>\n          @keyframes fadeIn {\n            from { opacity: 0; }\n            to { opacity: 1; }\n          }\n          @keyframes slideUp {\n            from { opacity: 0; transform: translateY(20px); }\n            to { opacity: 1; transform: translateY(0); }\n          }\n          button:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 4px 8px rgba(0,0,0,0.2);\n          }\n        </style>\n      ',document.body.appendChild(e),setTimeout(()=>{window.close(),setTimeout(()=>{document.hidden||(e.innerHTML='\n              <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(8px); display: flex; align-items: center; justify-center; z-index: 10000;">\n                <div style="background: white; padding: 2.5rem; border-radius: 1rem; max-width: 450px; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.5);">\n                  <div style="font-size: 3.5rem; margin-bottom: 1rem;">‚úÖ</div>\n                  <h2 style="color: #1f2937; font-size: 1.75rem; font-weight: 700; margin-bottom: 1rem;">Backend Shutdown Complete</h2>\n                  <div style="background: #f0fdf4; border: 2px solid #86efac; padding: 1rem; border-radius: 0.75rem; margin-bottom: 1.5rem;">\n                    <p style="color: #166534; font-weight: 600; margin: 0.25rem 0;">‚úì Backend Server Stopped</p>\n                    <p style="color: #15803d; font-size: 0.875rem; margin: 0.25rem 0;">‚úì Terminal ready for commands</p>\n                  </div>\n                  <p style="color: #6b7280; margin-bottom: 1.5rem; font-size: 0.95rem;">Please close this tab manually:</p>\n                  <div style="display: flex; gap: 0.75rem; justify-center; flex-wrap: wrap; margin-bottom: 1rem;">\n                    <kbd style="background: #f3f4f6; padding: 0.625rem 1.25rem; border-radius: 0.5rem; border: 1px solid #d1d5db; font-weight: 600; font-size: 0.95rem;">Ctrl + W</kbd>\n                    <span style="color: #9ca3af; font-size: 1.25rem;">or</span>\n                    <kbd style="background: #f3f4f6; padding: 0.625rem 1.25rem; border-radius: 0.5rem; border: 1px solid #d1d5db; font-weight: 600; font-size: 0.95rem;">‚åò + W</kbd>\n                  </div>\n                  <p style="color: #9ca3af; font-size: 0.8rem; margin-top: 1rem;">Or click the √ó on your browser tab</p>\n                </div>\n              </div>\n            ')},800)},1e3)},2e3)},disabled:c,className:"w-full px-3 py-1.5 rounded font-bold text-xs transition-all "+(c?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-gradient-to-r from-red-600 to-red-700 text-white hover:from-red-700 hover:to-red-800"),children:"üö™ Exit"})]})]}),ue.total>0&&o.jsxs("div",{className:"bg-gradient-to-br from-blue-50 via-indigo-50 to-blue-50 border-2 border-blue-400 rounded-xl p-4 shadow-lg",children:[o.jsxs("div",{className:"text-sm sm:text-base font-bold text-blue-900 mb-3 flex flex-wrap items-center gap-2",children:[o.jsxs("span",{className:"whitespace-nowrap",children:["Batch Progress: ",ue.current,"/",ue.total]}),o.jsxs("span",{className:"text-sm font-bold text-white bg-blue-600 px-2 py-1 rounded-lg whitespace-nowrap",children:[Math.round(ue.current/ue.total*100),"%"]})]}),o.jsx("div",{className:"w-full bg-blue-200 rounded-full h-3 sm:h-4 mb-3 overflow-hidden shadow-inner border border-blue-300",children:o.jsx("div",{className:"bg-gradient-to-r from-blue-500 via-indigo-600 to-blue-600 h-3 sm:h-4 rounded-full transition-all duration-300 ease-out shadow-md relative overflow-hidden",style:{width:ue.current/ue.total*100+"%"},children:o.jsx("div",{className:"absolute inset-0 animate-shimmer"})})}),o.jsx("div",{className:"text-xs sm:text-sm text-blue-700 font-medium truncate bg-white/50 px-3 py-1.5 rounded-lg",children:ue.status})]}),o.jsxs("div",{className:"bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 rounded-xl p-4 border-2 border-gray-700 shadow-2xl",children:[o.jsxs("h3",{className:"text-sm sm:text-base font-bold text-gray-200 mb-3 flex items-center gap-2",children:[o.jsx("span",{className:"text-xl",children:"üìã"}),o.jsx("span",{className:"truncate bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent",children:"Activity Log"})]}),o.jsx("div",{ref:nt,className:"h-36 sm:h-40 md:h-44 overflow-auto text-xs sm:text-sm font-mono text-green-400 whitespace-pre-wrap scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-800 bg-black/30 rounded-lg p-3 border border-gray-700",children:l||o.jsx("span",{className:"text-gray-500 italic",children:"Ready to process images..."})})]})]}),o.jsx("div",{className:"lg:col-span-9",children:o.jsxs("div",{className:"bg-gradient-to-br from-gray-50 via-white to-gray-50 rounded-2xl p-4 sm:p-5 md:p-6 border-2 border-gray-200 shadow-xl h-full",children:[o.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 md:mb-5 gap-3",children:[o.jsxs("div",{className:"flex flex-col gap-2 w-full sm:w-auto",children:[o.jsxs("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-800 flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl sm:text-3xl",children:"üñºÔ∏è"}),o.jsx("span",{className:"truncate bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent",children:"Image Preview"})]}),te&&o.jsx("p",{className:"text-sm sm:text-base font-semibold text-indigo-600 ml-10 sm:ml-12 truncate px-3 py-1 bg-indigo-50 rounded-lg inline-block",children:te})]}),b&&o.jsxs("span",{className:"px-3 sm:px-4 py-2 bg-gradient-to-r from-green-100 to-emerald-100 text-green-700 rounded-xl border-2 border-green-400 text-sm font-bold flex items-center gap-2 whitespace-nowrap shadow-md",children:[o.jsx("span",{className:"text-lg",children:"‚úì"})," Chart Detected"]})]}),e.length>0?o.jsxs("div",{className:"space-y-4 md:space-y-5",children:[o.jsx("div",{className:"bg-gradient-to-br from-white to-gray-50 rounded-xl p-3 sm:p-4 border-2 border-gray-200 shadow-lg",children:o.jsx("img",{src:x||e[0].url,alt:"Preview",className:"max-h-[250px] sm:max-h-[350px] md:max-h-[450px] lg:max-h-[550px] w-full object-contain mx-auto rounded-lg shadow-xl"})}),e.length>1&&o.jsxs("div",{className:"bg-white/50 backdrop-blur-sm rounded-xl p-3 border border-gray-200",children:[o.jsxs("p",{className:"text-xs font-semibold text-gray-600 mb-2 uppercase tracking-wide",children:["Image Gallery (",e.length,")"]}),o.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-indigo-400 scrollbar-track-gray-200",children:e.map((e,t)=>o.jsx("img",{src:e.url,alt:`Thumbnail ${t+1}`,onClick:()=>h(e.url),className:"h-14 w-14 sm:h-18 sm:w-18 md:h-20 md:w-20 object-cover rounded-xl cursor-pointer border-3 transition-all hover:scale-110 hover:shadow-lg flex-shrink-0 "+(x===e.url?"border-4 border-indigo-600 shadow-xl ring-2 ring-indigo-300":"border-2 border-gray-300 opacity-70 hover:opacity-100")},t))})]})]}):o.jsxs("div",{className:"h-[300px] sm:h-[400px] md:h-[500px] lg:h-[600px] flex flex-col items-center justify-center text-gray-400 bg-gradient-to-br from-gray-50 to-white rounded-xl border-2 border-dashed border-gray-300",children:[o.jsx("div",{className:"text-6xl sm:text-7xl md:text-8xl lg:text-9xl mb-4 md:mb-6 opacity-50",children:"üì∑"}),o.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-600",children:"No images loaded"}),o.jsx("p",{className:"text-sm sm:text-base mt-2 text-gray-500",children:'Click "Load Images" to get started'}),o.jsx("div",{className:"mt-6 px-6 py-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-700",children:"üí° Tip: You can load multiple images for batch processing"})]})]})})]})}),o.jsx(m,{isOpen:D,onClose:()=>F(!1),title:"Flat Field Correction Settings",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Fit Method"}),o.jsxs("select",{value:Ke.fit_method,onChange:e=>Qe({...Ke,fit_method:e.target.value}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200",children:[o.jsx("option",{value:"linear",children:"Linear Regression"}),o.jsx("option",{value:"pls",children:"PLS Regression"}),o.jsx("option",{value:"nn",children:"Neural Network"}),o.jsx("option",{value:"svm",children:"Support Vector Machine"})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Method for fitting the intensity profile"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Bins"}),o.jsx("input",{type:"number",value:Ke.bins,onChange:e=>Qe({...Ke,bins:parseInt(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500",min:"10",max:"200"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Bins for intensity sampling"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Smooth Window"}),o.jsx("input",{type:"number",value:Ke.smooth_window,onChange:e=>Qe({...Ke,smooth_window:parseInt(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500",min:"3",max:"21",step:"2"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Smoothing window size (odd)"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Polynomial Degree"}),o.jsx("input",{type:"number",value:Ke.degree,onChange:e=>Qe({...Ke,degree:parseInt(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500",min:"1",max:"10"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Polynomial expansion degree"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Max Iterations"}),o.jsx("input",{type:"number",value:Ke.max_iter,onChange:e=>Qe({...Ke,max_iter:parseInt(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500",min:"100",max:"10000"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Max iterations for fitting"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Tolerance"}),o.jsx("input",{type:"number",value:Ke.tol,onChange:e=>Qe({...Ke,tol:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500",step:"1e-9",min:"1e-10",max:"1e-3"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Stopping criterion tolerance"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Random Seed"}),o.jsx("input",{type:"number",value:Ke.random_seed,onChange:e=>Qe({...Ke,random_seed:parseInt(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500",min:"0",max:"9999"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"For reproducible results"})]})]}),o.jsxs("div",{className:"space-y-2 border-t pt-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",checked:Ke.manual_crop,onChange:e=>Qe({...Ke,manual_crop:e.target.checked}),className:"w-5 h-5 rounded accent-indigo-600",id:"manual_crop"}),o.jsx("label",{htmlFor:"manual_crop",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Manual Crop (Select ROI manually)"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",checked:Ke.interactions,onChange:e=>Qe({...Ke,interactions:e.target.checked}),className:"w-5 h-5 rounded accent-indigo-600",id:"interactions"}),o.jsx("label",{htmlFor:"interactions",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Include polynomial interactions"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",checked:Ke.verbose,onChange:e=>Qe({...Ke,verbose:e.target.checked}),className:"w-5 h-5 rounded accent-indigo-600",id:"ffc_verbose"}),o.jsx("label",{htmlFor:"ffc_verbose",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Verbose output (detailed logging)"})]})]}),o.jsx("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:o.jsxs("p",{className:"text-xs text-blue-800",children:[o.jsx("strong",{children:"Flat Field Correction"})," removes vignetting and illumination non-uniformity using a white field image."]})}),o.jsx("button",{onClick:()=>F(!1),className:"w-full px-4 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition",children:"Save Settings"})]})}),o.jsx(m,{isOpen:I,onClose:()=>M(!1),title:"Gamma Correction Settings",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Maximum Polynomial Degree"}),o.jsx("input",{type:"number",value:Xe.max_degree,onChange:e=>Ze({...Xe,max_degree:parseInt(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500",min:"1",max:"10"}),o.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Polynomial degree for fitting gamma profile (1-10)"})]}),o.jsx("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:o.jsxs("p",{className:"text-sm text-blue-800",children:[o.jsx("strong",{children:"Gamma Correction"})," fits an optimum polynomial mapping between measured neutral patch intensities and reference values, then applies it to the entire image."]})}),o.jsx("button",{onClick:()=>M(!1),className:"w-full px-4 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition",children:"Save Settings"})]})}),o.jsx(m,{isOpen:A,onClose:()=>B(!1),title:"White Balance Settings",children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:o.jsxs("p",{className:"text-sm text-blue-800",children:[o.jsx("strong",{children:"White Balance"})," performs diagonal white-balance correction using the neutral patches of the color checker. Computes diagonal matrix and applies it to the entire image."]})}),o.jsx("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:o.jsx("p",{className:"text-sm text-green-800",children:"‚úì This step uses default settings optimized for most cases."})}),o.jsx("button",{onClick:()=>B(!1),className:"w-full px-4 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition",children:"Close"})]})}),o.jsx(m,{isOpen:R,onClose:()=>L(!1),title:"Color Correction Settings",children:o.jsxs("div",{className:"space-y-4 max-h-[70vh] overflow-y-auto",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"CC Method"}),o.jsxs("select",{value:et.cc_method,onChange:e=>tt({...et,cc_method:e.target.value}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500",children:[o.jsx("option",{value:"ours",children:"Custom (ML-based)"}),o.jsx("option",{value:"conv",children:"Conventional (Finlayson 2015)"})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Choose between ML-based or conventional methods"})]}),"ours"===et.cc_method&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"ML Method"}),o.jsxs("select",{value:et.mtd,onChange:e=>tt({...et,mtd:e.target.value}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500",children:[o.jsx("option",{value:"linear",children:"Linear Regression"}),o.jsx("option",{value:"pls",children:"PLS Regression"}),o.jsx("option",{value:"nn",children:"Neural Network"})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Machine learning method for color transformation"})]}),"conv"===et.cc_method&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Conventional Method"}),o.jsx("select",{value:et.method,onChange:e=>tt({...et,method:e.target.value}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500",children:o.jsx("option",{value:"Finlayson 2015",children:"Finlayson 2015"})}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Classical color correction algorithm"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Polynomial Degree"}),o.jsx("input",{type:"number",value:et.degree,onChange:e=>tt({...et,degree:parseInt(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500",min:"1",max:"5"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Polynomial expansion degree"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Max Iterations"}),o.jsx("input",{type:"number",value:et.max_iterations,onChange:e=>tt({...et,max_iterations:parseInt(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500",min:"1000",max:"50000"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Max iterations for fitting"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Random State"}),o.jsx("input",{type:"number",value:et.random_state,onChange:e=>tt({...et,random_state:parseInt(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500",min:"0",max:"9999"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Random seed for reproducibility"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Tolerance"}),o.jsx("input",{type:"number",value:et.tol,onChange:e=>tt({...et,tol:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500",step:"1e-9",min:"1e-10",max:"1e-3"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Stopping criterion tolerance"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"N Samples"}),o.jsx("input",{type:"number",value:et.n_samples,onChange:e=>tt({...et,n_samples:parseInt(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500",min:"1",max:"100"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pixel samples per patch"})]}),o.jsx("div",{className:"flex items-center",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",checked:et.verbose,onChange:e=>tt({...et,verbose:e.target.checked}),className:"w-5 h-5 rounded accent-indigo-600",id:"cc_verbose"}),o.jsx("label",{htmlFor:"cc_verbose",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Verbose output"})]})})]}),"ours"===et.cc_method&&"pls"===et.mtd&&o.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border-2 border-purple-300",children:[o.jsxs("h4",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2",children:[o.jsx("span",{className:"text-purple-600",children:"üìä"})," PLS Regression Settings"]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Number of Components"}),o.jsx("input",{type:"number",value:et.ncomp,onChange:e=>tt({...et,ncomp:parseInt(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-400",min:"1",max:"10"}),o.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Number of PLS components to use (latent variables)"})]})]}),"ours"===et.cc_method&&"nn"===et.mtd&&o.jsxs("div",{className:"bg-cyan-50 p-4 rounded-lg border-2 border-cyan-300 space-y-4",children:[o.jsxs("h4",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2",children:[o.jsx("span",{className:"text-cyan-600",children:"üß†"})," Neural Network Settings"]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Number of Layers"}),o.jsx("input",{type:"number",value:et.nlayers,onChange:e=>tt({...et,nlayers:parseInt(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-cyan-400",min:"10",max:"500"}),o.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Total training epochs"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Learning Rate"}),o.jsx("input",{type:"number",value:et.learning_rate,onChange:e=>tt({...et,learning_rate:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-cyan-400",step:"0.0001",min:"0.0001",max:"0.1"}),o.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Neural network learning rate"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Batch Size"}),o.jsx("input",{type:"number",value:et.batch_size,onChange:e=>tt({...et,batch_size:parseInt(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-cyan-400",min:"4",max:"64"}),o.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Training batch size"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Patience"}),o.jsx("input",{type:"number",value:et.patience,onChange:e=>tt({...et,patience:parseInt(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-cyan-400",min:"5",max:"50"}),o.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Early stopping patience"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Dropout Rate"}),o.jsx("input",{type:"number",value:et.dropout_rate,onChange:e=>tt({...et,dropout_rate:parseFloat(e.target.value)}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-cyan-400",step:"0.05",min:"0",max:"0.5"}),o.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Dropout for regularization"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Optimizer"}),o.jsxs("select",{value:et.optim_type,onChange:e=>tt({...et,optim_type:e.target.value}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-cyan-400",children:[o.jsx("option",{value:"adam",children:"Adam"}),o.jsx("option",{value:"sgd",children:"SGD"}),o.jsx("option",{value:"rmsprop",children:"RMSprop"})]}),o.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Optimization algorithm"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Hidden Layers"}),o.jsx("input",{type:"text",value:JSON.stringify(et.hidden_layers),onChange:e=>{try{const t=JSON.parse(e.target.value);Array.isArray(t)&&tt({...et,hidden_layers:t})}catch(t){}},className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-cyan-400 font-mono text-sm",placeholder:"[64, 32, 16]"}),o.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Array of hidden layer sizes, e.g., [64, 32, 16]"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",checked:et.use_batch_norm,onChange:e=>tt({...et,use_batch_norm:e.target.checked}),className:"w-5 h-5 rounded accent-cyan-600",id:"use_batch_norm"}),o.jsx("label",{htmlFor:"use_batch_norm",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Use Batch Normalization"})]})]}),o.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",checked:$,onChange:e=>E(e.target.checked),className:"w-5 h-5 rounded accent-indigo-600 cursor-pointer",id:"saveCcModelInModal"}),o.jsxs("label",{htmlFor:"saveCcModelInModal",className:"font-semibold text-gray-700 cursor-pointer flex items-center gap-2",children:[o.jsx("span",{className:"text-lg",children:"üíæ"})," Save CC Model After Correction"]})]}),o.jsx("p",{className:"text-xs text-gray-600 mt-2 ml-8",children:"Automatically save the trained color correction model for future use"})]}),o.jsx("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:o.jsxs("p",{className:"text-xs text-blue-800",children:[o.jsx("strong",{children:"Color Correction"})," applies machine learning or conventional methods to map color checker patches to their reference values, then applies the transformation to the entire image."]})}),o.jsx("button",{onClick:()=>L(!1),className:"w-full px-4 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition",children:"Save Settings"})]})}),o.jsx(m,{isOpen:z,onClose:()=>W(!1),title:"Model Management",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-gradient-to-r from-violet-50 to-purple-50 p-4 rounded-lg border border-purple-200",children:[o.jsx("h3",{className:"font-bold text-gray-800 mb-2",children:"üì¶ Model Management"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Save trained color correction models for reuse across images"})]}),o.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[o.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"üíæ Save Model"}),o.jsx("p",{className:"text-sm text-gray-600 mb-3",children:o.jsx("span",{className:"font-medium",children:"Custom Save Directory (optional):"})}),o.jsx("input",{type:"text",value:Q,onChange:e=>X(e.target.value),placeholder:"e.g., C:\\Users\\YourName\\Desktop\\models",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 font-mono text-sm mb-2"}),o.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[o.jsx("span",{className:"text-xs text-gray-500",children:"üí°"}),o.jsxs("p",{className:"text-xs text-gray-500",children:["Leave blank to save in the default ",o.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"models/"})," folder. You can specify any directory (e.g., Desktop, Documents, external drive)."]})]}),o.jsx("button",{onClick:async function(){d(e=>e+"\nüíæ Saving color correction model..."),ee(!0);try{const e=await fetch("/api/save-model",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:`model_${Date.now()}`,folder:Q||null})});if(!e.ok){const t=await e.text();let r=`HTTP ${e.status}`;try{r=JSON.parse(t).error||t}catch{r=t}throw new Error(r)}const t=await e.json();t.success?(d(e=>e+`\n‚úì ${t.message}`),t.path&&d(e=>e+`\n  üìÅ Saved to: ${t.path}`),X("")):d(e=>e+`\n‚úó Failed: ${t.error||"Unknown error"}`)}catch(e){d(t=>t+`\n‚úó Save model failed: ${e.message}`)}finally{ee(!1)}},className:"w-full px-4 py-3 text-white font-semibold rounded-lg transition flex items-center justify-center gap-2 shadow-md "+(Z?"bg-blue-500 cursor-wait":"bg-green-500 hover:bg-green-600"),disabled:c||Z,children:Z?o.jsxs(o.Fragment,{children:[o.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),o.jsx("span",{children:"Saving..."})]}):o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"text-xl",children:"üíæ"}),o.jsx("span",{children:"Save Current Model"})]})}),o.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:"‚ö†Ô∏è Requires a trained model from a completed color correction"})]}),o.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[o.jsxs("h4",{className:"font-semibold text-gray-800 mb-2 flex items-center gap-2",children:[o.jsx("span",{children:"üìÇ"}),o.jsx("span",{children:"Load Saved Model"}),o.jsx("span",{className:"text-xs bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded-full",children:"Coming Soon"})]}),o.jsx("p",{className:"text-sm text-gray-600",children:"Load previously saved models to apply corrections without retraining."})]}),o.jsxs("button",{onClick:()=>W(!1),className:"w-full px-4 py-3 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition flex items-center justify-center gap-2",children:[o.jsx("span",{children:"‚úï"}),o.jsx("span",{children:"Close"})]}),o.jsx("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:o.jsxs("p",{className:"text-xs text-gray-600",children:[o.jsx("span",{className:"font-semibold",children:"How it works:"}),' After running color correction with a color chart, click "Save Current Model" to store the trained model. You can then use it later without needing a color chart.']})})]})}),o.jsx(m,{isOpen:G,onClose:()=>H(!1),title:"Save Corrected Images",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-cyan-50 p-4 rounded-lg border border-blue-200",children:[o.jsx("h3",{className:"font-bold text-gray-800 mb-2",children:"üíæ Select Images to Save"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Choose which processed images you want to export"})]}),o.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:U.length>0?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-2 border-b",children:[o.jsx("input",{type:"checkbox",checked:Y.length===U.length,onChange:e=>{e.target.checked?V(U.map(e=>e.name)):V([])},className:"w-5 h-5 rounded accent-indigo-600",id:"select-all"}),o.jsxs("label",{htmlFor:"select-all",className:"font-semibold text-gray-700 cursor-pointer",children:["Select All (",U.length," images)"]})]}),U.map((e,t)=>o.jsxs("div",{className:"flex items-center gap-3 bg-white p-3 rounded-lg border border-gray-200 hover:border-indigo-400 transition",children:[o.jsx("input",{type:"checkbox",checked:Y.includes(e.name),onChange:()=>toggleImageSelection(e.name),className:"w-5 h-5 rounded accent-indigo-600 cursor-pointer",id:`img-${t}`}),o.jsx("label",{htmlFor:`img-${t}`,className:"flex-1 text-sm font-medium text-gray-700 cursor-pointer",children:e.name}),o.jsxs("span",{className:"text-xs text-gray-500",children:[e.name.includes("FFC")&&"üü¶ FFC",e.name.includes("GC")&&"üåà GC",e.name.includes("WB")&&"‚öñÔ∏è WB",e.name.includes("CC")&&"üéØ CC"]})]},t))]}):o.jsxs("div",{className:"text-center py-8 text-gray-500",children:[o.jsx("p",{className:"text-4xl mb-2",children:"üì≠"}),o.jsx("p",{children:"No processed images available"})]})}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Save Directory (Optional)"}),o.jsx("input",{type:"text",value:q,onChange:e=>K(e.target.value),placeholder:"Leave empty for default (results folder)",className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-sm"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default: results/ folder in project directory"})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>H(!1),className:"flex-1 px-4 py-3 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition",children:"Cancel"}),o.jsxs("button",{onClick:bt,disabled:0===Y.length,className:"flex-1 px-4 py-3 font-semibold rounded-lg transition "+(Y.length>0?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:["üíæ Save ",Y.length>0?`(${Y.length})`:""]})]})]})}),o.jsx(m,{isOpen:se,onClose:()=>ae(!1),title:"ŒîE (Delta E) Metrics - Color Accuracy Results",maxWidth:"max-w-7xl",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg border-2 border-indigo-200",children:[o.jsxs("p",{className:"text-sm text-gray-700 mb-3",children:[o.jsx("strong",{children:"Delta E (ŒîE)"})," measures color difference between images. Lower values = better color accuracy."]}),o.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[o.jsxs("li",{children:["‚Ä¢ ",o.jsx("strong",{children:"ŒîE < 1.0:"})," Not perceptible by human eye"]}),o.jsxs("li",{children:["‚Ä¢ ",o.jsx("strong",{children:"ŒîE 1.0-2.0:"})," Perceptible only to trained observers"]}),o.jsxs("li",{children:["‚Ä¢ ",o.jsx("strong",{children:"ŒîE 2.0-3.5:"})," Perceptible at a glance"]}),o.jsxs("li",{children:["‚Ä¢ ",o.jsx("strong",{children:"ŒîE 3.5-5.0:"})," Clearly noticeable difference"]}),o.jsxs("li",{children:["‚Ä¢ ",o.jsx("strong",{children:"ŒîE > 5.0:"})," Obvious color difference"]})]})]}),Object.keys(ne).length>0?o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"font-bold text-gray-800 text-lg mb-3",children:"üìä Delta E Metrics Table"}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full border-collapse",children:[o.jsx("thead",{children:o.jsxs("tr",{className:"bg-indigo-100",children:[o.jsx("th",{className:"border border-indigo-300 px-3 py-2 text-left font-bold text-gray-800",children:"Step"}),o.jsx("th",{className:"border border-indigo-300 px-3 py-2 text-center font-bold text-gray-800",children:"DE_mean"}),o.jsx("th",{className:"border border-indigo-300 px-3 py-2 text-center font-bold text-gray-800",children:"DE_min"}),o.jsx("th",{className:"border border-indigo-300 px-3 py-2 text-center font-bold text-gray-800",children:"DE_max"}),o.jsx("th",{className:"border border-indigo-300 px-3 py-2 text-center font-bold text-gray-800",children:"DE_std"}),o.jsx("th",{className:"border border-indigo-300 px-3 py-2 text-center font-bold text-gray-800",children:"Quality"})]})}),o.jsx("tbody",{children:["FFC","GC","WB","CC"].filter(e=>ne[e]).map(e=>{const t=ne[e],r=ne._method||"",s=t.DE_mean,a="number"==typeof s?s:parseFloat(s);let n="",l="",i="";a<1?(n="Excellent",l="bg-green-50",i="üü¢"):a<2?(n="Very Good",l="bg-green-50",i="üü¢"):a<3.5?(n="Good",l="bg-yellow-50",i="üü°"):a<5?(n="Fair",l="bg-orange-50",i="üü†"):(n="Needs Improvement",l="bg-red-50",i="üî¥");const d=e=>null==e?"-":"number"==typeof e?e.toFixed(2):e;return o.jsxs("tr",{className:l,children:[o.jsxs("td",{className:"border border-gray-300 px-3 py-2 font-bold text-gray-800",children:["FFC"===e&&"üü¶ FFC","GC"===e&&"üåà GC","WB"===e&&"‚öñÔ∏è WB","CC"===e&&"üéØ CC"+(r?` (${r})`:"")]}),o.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center font-bold text-lg text-gray-900",children:d(t.DE_mean)}),o.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center text-sm",children:d(t.DE_min)}),o.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center text-sm",children:d(t.DE_max)}),o.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center text-sm",children:d(t.DE_std)}),o.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center",children:o.jsxs("span",{className:"inline-flex items-center gap-1",children:[o.jsx("span",{className:"text-xl",children:i}),o.jsx("span",{className:"text-xs font-semibold",children:n})]})})]},e)})})]})}),o.jsx("div",{className:"grid grid-cols-2 gap-3 mt-4",children:["FFC","GC","WB","CC"].filter(e=>ne[e]).map(e=>{const t=ne[e],r=ne._method||"",s=t.DE_mean,a="number"==typeof s?s:parseFloat(s);let n="",l="";return a<1?(n="bg-green-100 border-green-400",l="üü¢"):a<2?(n="bg-green-50 border-green-300",l="üü¢"):a<3.5?(n="bg-yellow-50 border-yellow-300",l="üü°"):a<5?(n="bg-orange-50 border-orange-300",l="üü†"):(n="bg-red-50 border-red-300",l="üî¥"),o.jsxs("div",{className:`p-3 rounded-lg border-2 ${n}`,children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("span",{className:"text-xl",children:l}),o.jsxs("span",{className:"font-bold text-sm text-gray-800",children:["FFC"===e&&"üü¶ FFC","GC"===e&&"üåà GC","WB"===e&&"‚öñÔ∏è WB","CC"===e&&"üéØ CC"+(r?` (${r})`:"")]})]}),o.jsx("div",{className:"text-2xl font-bold text-gray-900",children:"number"==typeof s?s.toFixed(2):s}),o.jsx("div",{className:"text-xs text-gray-600",children:"DE_mean"})]},e)})})]}):o.jsxs("div",{className:"text-center py-8 text-gray-500",children:[o.jsx("p",{className:"text-4xl mb-2",children:"üìä"}),o.jsx("p",{children:"No Delta E metrics available"})]}),o.jsx("button",{onClick:()=>ae(!1),className:"w-full px-4 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition",children:"Close"})]})}),o.jsx(m,{isOpen:oe,onClose:()=>ie(!1),title:"Apply Correction to Others",children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{className:"text-gray-600",children:"Select images to apply the trained color correction model:"}),o.jsx("div",{className:"max-h-96 overflow-y-auto border rounded-lg p-3 space-y-2",children:e.map((e,t)=>o.jsxs("label",{className:"flex items-center gap-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:de.includes(t),onChange:()=>function(e){ce(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])}(t),className:"w-5 h-5 rounded accent-indigo-600"}),o.jsx("img",{src:e.url,alt:e.file.name,className:"w-16 h-16 object-cover rounded"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-medium text-sm text-gray-800",children:e.file.name}),o.jsxs("div",{className:"text-xs text-gray-500",children:[(e.file.size/1024).toFixed(1)," KB"]})]})]},t))}),o.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[o.jsxs("p",{className:"text-sm text-blue-800",children:[o.jsx("strong",{children:de.length})," of ",o.jsx("strong",{children:e.length})," images selected"]}),o.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"ÔøΩ Images will be processed sequentially (one at a time)"})]}),o.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[o.jsx("button",{onClick:()=>ie(!1),className:"flex-1 px-3 sm:px-4 py-2.5 sm:py-3 bg-gray-200 text-gray-700 text-sm sm:text-base font-semibold rounded-lg hover:bg-gray-300 transition touch-manipulation",children:"Cancel"}),o.jsxs("button",{onClick:async function(){if(0!==de.length){ie(!1),g(!0),be({current:0,total:de.length,status:"Initializing..."}),d(e=>e+"\n"+"=".repeat(70)),d(e=>e+"\nüé® APPLY TO OTHERS - Model Application"),d(e=>e+"\n"+"=".repeat(70)),d(e=>e+`\nüìä Applying trained model to ${de.length} image(s)...`),d(e=>e+"\nüí° Mode: Sequential processing (one image at a time)");try{const s="ours"===et.cc_method?et.mtd:"conventional";let a=0,n=0;for(let l=0;l<de.length;l++){const o=de[l],i=e[o];be({current:l+1,total:de.length,status:`Processing ${i.file.name}...`}),d(e=>e+`\n\n${"‚îÄ".repeat(70)}`),d(e=>e+`\n[${l+1}/${de.length}] ${i.file.name}`),d(e=>e+`\n${"‚îÄ".repeat(70)}`),d(e=>e+"\n  üîß Applying trained model...");try{const e=await fetch("/api/apply-single",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_index:o,method:s,ffcEnabled:v,gcEnabled:w,wbEnabled:k,ccEnabled:_,ffcSettings:Ke,gcSettings:Xe,ccSettings:et})});let r;try{r=await e.json()}catch(t){d(e=>e+`\n  ‚ùå Failed to parse response: ${(null==t?void 0:t.message)||t}`),n++;continue}if(e.ok&&r.success){if(a++,d(e=>e+"\n  ‚úÖ Model applied successfully"),r.corrected_images){const e=r.corrected_images.length;d(t=>t+`\n  üìä Generated ${e} correction step(s)`)}}else{const t=(null==r?void 0:r.error)||`HTTP ${e.status}`;d(e=>e+`\n  ‚ùå Application error: ${t}`),n++}}catch(r){d(e=>e+`\n  ‚ùå Error: ${(null==r?void 0:r.message)||r}`),n++}}be({current:de.length,total:de.length,status:"Complete!"}),d(e=>e+`\n\n${"=".repeat(70)}`),d(e=>e+"\n‚úÖ BATCH APPLICATION COMPLETE"),d(e=>e+`\n${"=".repeat(70)}`),d(e=>e+"\nüìä Summary:"),d(e=>e+`\n   ‚Ä¢ Total images: ${de.length}`),d(e=>e+`\n   ‚Ä¢ Successfully processed: ${a}`),d(e=>e+`\n   ‚Ä¢ Failed: ${n}`),d(e=>e+`\n${"=".repeat(70)}`),a>0&&(ye(!0),d(e=>e+`\nüí° Tip: Click "Save Images" to save all ${a} corrected images`))}catch(s){d(e=>e+`\n\n‚ùå ERROR: ${s.message}`),d(e=>e+"\n"+"=".repeat(60))}finally{g(!1),setTimeout(()=>{be({current:0,total:0,status:""})},3e3)}}else d(e=>e+"\n‚ö†Ô∏è No images selected.")},disabled:0===de.length,className:"flex-1 px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base font-semibold rounded-lg transition touch-manipulation "+(de.length>0?"bg-cyan-600 text-white hover:bg-cyan-700 active:scale-95":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:["üé® Apply (",de.length,")"]})]})]})}),o.jsx(m,{isOpen:he,onClose:()=>pe(!1),title:"Process All Images",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[o.jsx("p",{className:"text-orange-800 font-semibold mb-2",children:"‚ö° Batch Processing Mode"}),o.jsxs("p",{className:"text-sm text-orange-700",children:["This will process all ",o.jsx("strong",{children:e.length})," loaded images through the complete pipeline."]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("span",{className:"text-2xl",children:"üîç"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-semibold text-gray-800",children:"1. Chart Detection"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Each image will be checked for color charts"})]})]}),o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("span",{className:"text-2xl",children:"‚úÖ"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-semibold text-gray-800",children:"2. If Chart Detected"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Full correction pipeline will run (FFC ‚Üí GC ‚Üí WB ‚Üí CC)"})]})]}),o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("span",{className:"text-2xl",children:"‚ö†Ô∏è"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-semibold text-gray-800",children:"3. If No Chart"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Image will be skipped (or you can apply previous correction)"})]})]})]}),o.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:[o.jsx("p",{className:"text-sm text-gray-700",children:o.jsx("strong",{children:"Current Settings:"})}),o.jsxs("ul",{className:"text-sm text-gray-600 mt-2 space-y-1 ml-4",children:[o.jsxs("li",{children:["‚Ä¢ FFC: ",v?"‚úÖ Enabled":"‚ùå Disabled"]}),o.jsxs("li",{children:["‚Ä¢ GC: ",w?"‚úÖ Enabled":"‚ùå Disabled"]}),o.jsxs("li",{children:["‚Ä¢ WB: ",k?"‚úÖ Enabled":"‚ùå Disabled"]}),o.jsxs("li",{children:["‚Ä¢ CC: ",_?"‚úÖ Enabled":"‚ùå Disabled"]}),o.jsx("li",{children:"‚Ä¢ Processing: Sequential (one at a time)"})]})]}),o.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[o.jsx("button",{onClick:()=>pe(!1),className:"flex-1 px-3 sm:px-4 py-2.5 sm:py-3 bg-gray-200 text-gray-700 text-sm sm:text-base font-semibold rounded-lg hover:bg-gray-300 transition touch-manipulation",children:"Cancel"}),o.jsx("button",{onClick:async function(){if(0===e.length)return void d(e=>e+"\n‚ö†Ô∏è No images loaded.");pe(!1),g(!0),be({current:0,total:e.length,status:"Starting..."}),d(e=>e+"\n"+"=".repeat(70)),d(e=>e+"\n‚ö° PROCESS ALL - Train Model for Each Image"),d(e=>e+"\n"+"=".repeat(70)),d(t=>t+`\nüìã Processing ${e.length} image(s)...`),d(e=>e+"\nüí° Mode: Sequential processing (one image at a time)"),d(e=>e+"\nüìù Starting batch processing...");let t=0,r=0;try{for(let n=0;n<e.length;n++){const l=e[n];be({current:n+1,total:e.length,status:`Processing ${l.file.name}...`}),d(e=>e+`\n\n${"‚îÄ".repeat(70)}`),d(t=>t+`\n[${n+1}/${e.length}] ${l.file.name}`),d(e=>e+`\n${"‚îÄ".repeat(70)}`),d(e=>e+"\n  üîç Step 1: Detecting color chart (optional)...");let o=!1;try{const e=await fetch("/api/detect-chart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_index:n})}),t=await e.json(),r=null==t?void 0:t.detection;if(e.ok&&t.success&&(null==r?void 0:r.detected)){o=!0;const e="number"==typeof(null==r?void 0:r.confidence)?` (${(100*r.confidence).toFixed(0)}% confidence)`:"";d(t=>t+`\n  ‚úÖ Color chart detected${e}`)}else{const e=(null==r?void 0:r.message)||(null==t?void 0:t.error)||"Chart detection did not confirm a chart.";d(t=>t+`\n  ‚ö†Ô∏è ${e}`)}}catch(s){d(e=>e+`\n  ‚ö†Ô∏è Chart detection skipped: ${(null==s?void 0:s.message)||s}`)}o||d(e=>e+"\n  ‚ÑπÔ∏è Continuing without chart-guided adjustments."),d(e=>e+"\n  üîß Step 2: Running correction pipeline...");const i=await fetch("/api/run-cc",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_index:n,is_batch_mode:!0,computeDeltaE:!1,method:"ours"===et.cc_method?et.mtd:"conventional",ffcEnabled:v,gcEnabled:w,wbEnabled:k,ccEnabled:_,saveCcModel:$,ffcSettings:Ke,gcSettings:Xe,ccSettings:et})});let c;try{c=await i.json()}catch(a){d(e=>e+`\n  ‚ùå Failed to parse pipeline response: ${(null==a?void 0:a.message)||a}`),r++;continue}if(i.ok&&c.success){if(t++,d(e=>e+"\n  ‚úÖ Pipeline completed successfully"),c.delta_e_summary){d(e=>e+"\n  üìä Quality Metrics:");["FFC","GC","WB","CC"].forEach(e=>{var t;if(void 0!==(null==(t=c.delta_e_summary[e])?void 0:t.DE_mean)){const t=c.delta_e_summary[e].DE_mean.toFixed(2);d(r=>r+`\n     ‚Ä¢ ${e}: ŒîE = ${t}`)}})}}else{const e=(null==c?void 0:c.error)||`HTTP ${i.status}`;d(t=>t+`\n  ‚ùå Pipeline error: ${e}`),r++}}be({current:e.length,total:e.length,status:"Complete!"}),d(e=>e+`\n\n${"=".repeat(70)}`),d(e=>e+"\n‚úÖ BATCH PROCESSING COMPLETE"),d(e=>e+`\n${"=".repeat(70)}`),d(e=>e+"\nüìä Summary:"),d(t=>t+`\n   ‚Ä¢ Total images: ${e.length}`),d(e=>e+`\n   ‚Ä¢ Successfully processed: ${t}`),d(e=>e+`\n   ‚Ä¢ Failed: ${r}`),d(e=>e+`\n${"=".repeat(70)}`),t>0&&(ye(!0),d(e=>e+`\nüí° Tip: Click "Save Images" to save all ${t} corrected images`))}catch(n){d(e=>e+`\n\n‚ùå Batch processing error: ${n.message}`),d(e=>e+`\n${"=".repeat(70)}`)}finally{g(!1),setTimeout(()=>{be({current:0,total:0,status:""})},3e3)}},className:"flex-1 px-3 sm:px-4 py-2.5 sm:py-3 bg-orange-600 text-white text-sm sm:text-base font-semibold rounded-lg hover:bg-orange-700 transition touch-manipulation active:scale-95",children:"‚ö° Start Processing"})]})]})}),o.jsx(m,{isOpen:je,onClose:()=>ve(!1),title:"Difference Image (JET Colormap)",maxWidth:"max-w-6xl",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("p",{className:"text-gray-600",children:["This image shows the pixel-wise differences between the original and corrected images.",o.jsx("br",{}),o.jsx("span",{className:"text-sm text-gray-500",children:"Blue = minimal change, Red = maximum change"})]}),Ce.difference&&o.jsx("div",{className:"border-2 border-gray-300 rounded-lg overflow-hidden",children:o.jsx("img",{src:Ce.difference,alt:"Difference Map",className:"w-full h-auto"})}),o.jsx("button",{onClick:()=>ve(!1),className:"w-full px-4 py-3 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition",children:"Close"})]})}),o.jsx(m,{isOpen:Ne,onClose:()=>we(!1),title:"Before & After Comparison",children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{className:"text-gray-600 mb-4",children:"Side-by-side comparison of original and color-corrected images"}),Ce.original&&Ce.corrected&&o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"border-2 border-gray-300 rounded-lg overflow-hidden",children:[o.jsx("div",{className:"bg-gray-100 px-3 py-2 font-semibold text-gray-700 text-sm border-b border-gray-300",children:"Before (Original)"}),o.jsx("img",{src:Ce.original,alt:"Original",className:"w-full h-auto"})]}),o.jsxs("div",{className:"border-2 border-green-300 rounded-lg overflow-hidden",children:[o.jsx("div",{className:"bg-green-100 px-3 py-2 font-semibold text-green-700 text-sm border-b border-green-300",children:"After (Corrected)"}),o.jsx("img",{src:Ce.corrected,alt:"Corrected",className:"w-full h-auto"})]})]}),o.jsx("button",{onClick:()=>we(!1),className:"w-full px-4 py-3 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition",children:"Close"})]})}),o.jsx(m,{isOpen:Me,onClose:()=>Ae(!1),title:"RGB Scatter Plot Comparison",children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{className:"text-gray-600",children:"Comparison of RGB color distribution before and after color correction"}),Be&&o.jsx("div",{className:"border-2 border-gray-300 rounded-lg overflow-hidden bg-white",children:o.jsx("img",{src:Be,alt:"RGB Scatter Plot",className:"w-full h-auto"})}),o.jsx("button",{onClick:()=>Ae(!1),className:"w-full px-4 py-3 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition",children:"Close"})]})}),o.jsx(m,{isOpen:We,onClose:()=>Ge(!1),title:"Save Processed Images",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:(fe?"bg-green-50 border-green-200":"bg-blue-50 border-blue-200")+" border rounded-lg p-4",children:[o.jsx("p",{className:(fe?"text-green-800":"text-blue-800")+" font-semibold mb-2",children:fe?"üéâ Batch Processing Complete!":"üíæ Select Steps & Images to Save"}),o.jsx("p",{className:"text-sm text-blue-700",children:fe?'All processed images from "Process All" are ready to save. Select the steps you want to save.':"Choose which processing steps and images you want to save."})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Save Directory:"}),o.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Enter full path (e.g., C:\\Users\\YourName\\Desktop\\results)"}),o.jsx("div",{className:"flex gap-2",children:o.jsx("input",{type:"text",value:q,onChange:e=>K(e.target.value),placeholder:"Default: results folder in backend directory",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 font-mono text-sm"})}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave blank to use default results folder"})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Processing Steps:"}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:["FFC","GC","WB","CC"].map(e=>o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer bg-gray-50 p-3 rounded-lg border border-gray-200 hover:bg-gray-100 transition",children:[o.jsx("input",{type:"checkbox",checked:He.includes(e),onChange:()=>function(e){Ue(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])}(e),className:"w-5 h-5 rounded accent-indigo-600 cursor-pointer"}),o.jsx("span",{className:"font-bold text-gray-700",children:e})]},e))})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsxs("h4",{className:"font-semibold text-gray-800",children:["Images ",fe?`(${Ve.length} batch processed)`:`(${U.length} processed)`,":"]}),o.jsx("button",{onClick:()=>{fe?Je.length===Ve.length?Ye([]):Ye(Ve.map(e=>e.image_index)):Je.length===U.length?Ye([]):Ye(U.map(e=>e.filename))},className:"text-xs px-2 py-1 bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 transition",children:fe&&Je.length===Ve.length||!fe&&Je.length===U.length?"Deselect All":"Select All"})]}),o.jsx("div",{className:"max-h-48 overflow-y-auto border border-gray-200 rounded-lg",children:fe?Ve.map((e,t)=>o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer px-3 py-2 hover:bg-gray-50 transition border-b border-gray-100 last:border-b-0",children:[o.jsx("input",{type:"checkbox",checked:Je.includes(e.image_index),onChange:()=>{Ye(t=>t.includes(e.image_index)?t.filter(t=>t!==e.image_index):[...t,e.image_index])},className:"w-4 h-4 rounded accent-green-600 cursor-pointer"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("span",{className:"text-sm font-medium text-gray-700",children:e.filename}),o.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",e.available_steps.join(", "),")"]})]})]},t)):U.map((e,t)=>o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer px-3 py-2 hover:bg-gray-50 transition border-b border-gray-100 last:border-b-0",children:[o.jsx("input",{type:"checkbox",checked:Je.includes(e.filename),onChange:()=>{return t=e.filename,void Ye(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"w-4 h-4 rounded accent-indigo-600 cursor-pointer"}),o.jsx("span",{className:"text-sm text-gray-700",children:e.filename})]},t))})]}),o.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:[o.jsxs("p",{className:"text-sm text-gray-700",children:[o.jsx("strong",{children:"Will save:"})," ",He.length," step(s) √ó ",Je.length," image(s)"," = ",He.length*Je.length," file(s)"]}),q&&o.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[o.jsx("strong",{children:"Directory:"})," ",q]})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>{Ge(!1),fe&&ye(!1)},className:"flex-1 px-4 py-3 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition",children:"Cancel"}),fe?o.jsx("button",{onClick:()=>{!async function(){if(0===He.length)return void d(e=>e+"\n‚ö†Ô∏è Please select at least one processing step.");const e=Je.length>0?Je:null;Ge(!1),d(t=>t+`\nüíæ Saving ${e?Je.length:"all"} batch processed image(s)...`);try{const t=await fetch("/api/save-batch-images",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selected_steps:He,selected_images:e,directory:q||void 0})}),r=await t.json();r.success?(d(e=>e+`\n‚úì ${r.message}`),d(e=>e+`\nüìä Saved ${r.saved_count} files from ${r.image_count} images`),d(e=>e+`\nüìÅ Location: ${r.directory}`),Ye([]),ye(!1)):d(e=>e+`\n‚úó Batch save failed: ${r.error}`)}catch(t){d(e=>e+`\n‚úó Batch save failed: ${t.message}`)}}(),ye(!1)},disabled:0===He.length,className:"flex-1 px-4 py-3 font-semibold rounded-lg transition "+(He.length>0?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"üíæ Save All Batch Images"}):o.jsx("button",{onClick:bt,disabled:0===He.length||0===Je.length,className:"flex-1 px-4 py-3 font-semibold rounded-lg transition "+(He.length>0&&Je.length>0?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"üíæ Save Selected"})]})]})})]})}i.memo(({children:e,className:t="",gradient:r=!1})=>o.jsx("div",{className:`bg-white rounded-xl shadow-md border border-gray-200 p-4 transition-all hover:shadow-lg ${r?"bg-gradient-to-br from-white to-gray-50":""} ${t}`,children:e})),i.memo(({children:e,onClick:t,variant:r="primary",disabled:s=!1,className:a="",fullWidth:n=!1,size:l="md"})=>o.jsx("button",{onClick:t,disabled:s,className:`\n        font-semibold rounded-lg transition-all duration-200 flex items-center justify-center gap-2\n        ${{primary:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white hover:from-indigo-700 hover:to-purple-700 shadow-lg hover:shadow-xl active:scale-95",secondary:"bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-300",success:"bg-gradient-to-r from-green-500 to-emerald-600 text-white hover:from-green-600 hover:to-emerald-700 shadow-lg",danger:"bg-gradient-to-r from-red-500 to-pink-600 text-white hover:from-red-600 hover:to-pink-700 shadow-lg",outline:"border-2 border-indigo-600 text-indigo-600 hover:bg-indigo-50"}[r]}\n        ${{sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[l]}\n        ${n?"w-full":""}\n        ${s?"opacity-50 cursor-not-allowed hover:scale-100":""}\n        ${a}\n      `,children:e})),i.memo(({title:e,icon:t,children:r,defaultOpen:s=!1})=>{const[a,n]=i.useState(s);return o.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm hover:shadow-md transition-shadow",children:[o.jsxs("button",{onClick:()=>n(!a),className:"w-full px-4 py-3 flex items-center justify-between bg-gradient-to-r from-gray-50 to-white hover:from-gray-100 hover:to-gray-50 transition-colors",children:[o.jsxs("span",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[o.jsx("span",{className:"text-xl",children:t}),e]}),o.jsx("svg",{className:"w-5 h-5 text-gray-500 transition-transform duration-200 "+(a?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&o.jsx("div",{className:"p-4 bg-white border-t border-gray-100 animate-slideDown",children:r})]})}),c.createRoot(document.getElementById("root")).render(o.jsx(i.StrictMode,{children:o.jsx(g,{})}));
